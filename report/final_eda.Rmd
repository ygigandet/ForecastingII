
## Exploration and Visualization

Our work is to forecast the number of bikes available for every 10 minutes of Wednesday, May 25th, at every stations in the city of Sion. To do so, we first wanted to visualize the location of all the stations in Sion, so we could understand better the distance between the stations and the possible purpose for which each user would use the bikes. In addition, we will be able to identify the surroundings at each station, and determine if it's a residential/educational or a business area.

On the following map, we can observe how the stations (blue markers) are distributed around Sion city. The stations Châteauneuf-Furet (left) and UNIL/UNIGE Bramois (right) are the farthest from the center of Sion, while Gare de Sion Nord, Gare de Sion Sud, and Campus Energypolis are at the center. Now, we segment by area type each station:

*  **Residential / Education Area:** 
Blancherie, Ancien Stand, P+R Potence, Châteauneuf-Furet, Scex, Platta, Agasse,
Bietschhorn, P+R Stade, UNIL/UNIGE Bramois               

* **Business Area:**
Gare de Sion Nord (GSN),  Gare de Sion Sud (GSD), Campus Energypolis, Cible, Planta, Hôpital - CRR

```{r, echo=FALSE, message=FALSE}
stations <- leaflet(height=300, width=900) %>% 
  addTiles() %>% 
  setView(lng = 7.368145, lat = 46.232163, zoom = 14) %>%
  addMarkers(lng=7.359509, lat=46.227851, label="Gare de Sion Nord")%>%
  addMarkers(lng=7.359278, lat=46.226600, label="Gare de Sion Sud")%>%
  addMarkers(lng=7.362768, lat=46.226805, label="Campus Energypolis")%>%
  addMarkers(lng=7.354689, lat=46.225429, label="Blancherie")%>%
  addMarkers(lng=7.350697, lat=46.228497, label="Ancien Stand")%>%
  addMarkers(lng=7.342870, lat=46.226620, label="P+R Potence")%>%
  addMarkers(lng=7.333030, lat=46.224212, label="Châteauneuf-Furet")%>%
  addMarkers(lng=7.363206, lat=46.232220, label="Scex")%>%
  addMarkers(lng=7.358595, lat=46.232493, label="Planta")%>%
  addMarkers(lng=7.361292, lat=46.235840, label="Cible")%>%
  addMarkers(lng=7.364446, lat=46.238478, label="Platta")%>%
  addMarkers(lng=7.350275, lat=46.235155, label="Agasse")%>%
  addMarkers(lng=7.373780, lat=46.230535, label="Bietschhorn")%>%
  addMarkers(lng=7.377835, lat=46.235056, label="P+R Stade")%>%
  addMarkers(lng=7.386038, lat=46.234684, label="Hôpital - CRR")%>%
  addMarkers(lng=7.400422, lat=46.231082, label="UNIL/UNIGE Bramois")
stations 

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# Creation of time series
Bietschhorn <- as_tsibble(Bietschhorn, index = date)
Blancherie <- as_tsibble(Blancherie, index = date)
Cible <- as_tsibble(Cible, index = date)
GSD <- as_tsibble(GSD, index = date)
PRP <- as_tsibble(PRP, index = date)
Platta <- as_tsibble(Platta, index = date)
Planta <- as_tsibble(Planta, index = date)
CRR <- as_tsibble(CRR, index = date)
Campus <- as_tsibble(Campus, index = date)
Scex <- as_tsibble(Scex, index = date)
Furet <- as_tsibble(Furet, index = date)
Agasse <- as_tsibble(Agasse, index = date)
Stade <- as_tsibble(Stade, index = date)
GSN <- as_tsibble(GSN, index = date)
Stand <- as_tsibble(Stand, index = date)
Bramois <- as_tsibble(Bramois, index = date)
  
  
############ Prepare data ################

bietschhorn_bike <- Bietschhorn
bietschhorn_bike$Bietschhorn <- bietschhorn_bike$Bike + bietschhorn_bike$`E-Bike`
bietschhorn_bike <- bietschhorn_bike %>%
  select(date, Bietschhorn)

blancherie_bike <- Blancherie
blancherie_bike$Blancherie <- blancherie_bike$Bike + blancherie_bike$`E-Bike`
blancherie_bike <- blancherie_bike %>%
  select(date, Blancherie)

cible_bike <- Cible
cible_bike$Cible <- cible_bike$Bike + cible_bike$`E-Bike`
cible_bike <- cible_bike %>%
  select(date, Cible)

gsd_bike <- GSD
gsd_bike$GSD <- gsd_bike$Bike + gsd_bike$`E-Bike`
gsd_bike <- gsd_bike %>%
  select(date, GSD)

prp_bike <- PRP
prp_bike$PRP <- prp_bike$Bike + prp_bike$`E-Bike`
prp_bike <- prp_bike %>%
  select(date, PRP)

platta_bike <- Platta
platta_bike$Platta <- platta_bike$Bike + platta_bike$`E-Bike`
platta_bike <- platta_bike %>%
  select(date, Platta)

planta_bike <- Planta
planta_bike$Planta <- planta_bike$Bike + planta_bike$`E-Bike`
planta_bike <- planta_bike %>%
  select(date, Planta)

crr_bike <- CRR
crr_bike$CRR <- crr_bike$Bike + crr_bike$`E-Bike`
crr_bike <- crr_bike %>%
  select(date, CRR)

campus_bike <- Campus
campus_bike$Campus <- campus_bike$Bike + campus_bike$`E-Bike`
campus_bike <- campus_bike %>%
  select(date, Campus)

scex_bike <- Scex
scex_bike$Scex <- scex_bike$Bike + scex_bike$`E-Bike`
scex_bike <- scex_bike %>%
  select(date, Scex)

furet_bike <- Furet
furet_bike$Furet <- furet_bike$Bike + furet_bike$`E-Bike`
furet_bike <- furet_bike %>%
  select(date, Furet)

agasse_bike <- Agasse
agasse_bike$Agasse <- agasse_bike$Bike + agasse_bike$`E-Bike`
agasse_bike <- agasse_bike %>%
  select(date, Agasse)

stade_bike <- Stade
stade_bike$Stade <- stade_bike$Bike + stade_bike$`E-Bike`
stade_bike <- stade_bike %>%
  select(date, Stade)

gsn_bike <- GSN
gsn_bike$GSN <- gsn_bike$Bike + gsn_bike$`E-Bike`
gsn_bike <- gsn_bike %>%
  select(date, GSN)

stand_bike <- Stand
stand_bike$Stand <- stand_bike$Bike + stand_bike$`E-Bike`
stand_bike <- stand_bike %>%
  select(date, Stand)

bramois_bike <- Bramois
bramois_bike$Bramois <- bramois_bike$Bike + bramois_bike$`E-Bike`
bramois_bike <- bramois_bike %>%
  select(date, Bramois)

################# Create Master table #####################

library(purrr)
sion_bike <- list(bietschhorn_bike, blancherie_bike, cible_bike, gsd_bike, prp_bike, 
                platta_bike, planta_bike, crr_bike, campus_bike, scex_bike, furet_bike,
                agasse_bike, stade_bike, gsn_bike, stand_bike, bramois_bike) %>%
  reduce(dplyr::left_join, by= "date")

# Convert ts to tsibble and pivot to long format
sion_bike_long <- sion_bike %>%   
  gather("Bietschhorn", "Blancherie", "Cible", "GSD", "PRP", "Platta", "Planta",
         "CRR", "Campus", "Scex", "Furet", "Agasse", "Stade", "GSN", "Stand",
         "Bramois", key = Stations, value = Number)

sion_bike_diff<- sion_bike
sion_bike_diff$time <- as.POSIXct(sion_bike_diff$date, format = "%H:%M:%S %p")
sion_bike_diff$time <- as.numeric(sion_bike_diff$date) #convert date values to numeric
as.numeric(sion_bike_diff$time)
sion_bike_diff <- sion_bike_diff %>% 
  mutate(Minutes = time - lag(time, default = first(time))) # subtract days
sion_bike_diff$Minutes <- as.numeric(as.character(sion_bike_diff$Minutes))/60 # transform to minutes
sion_bike_diff$Minutes[1] <- 60

sion_bike_diff <- sion_bike_diff %>%
  as.data.frame() %>%
  select(Minutes)

sion_bike_table <- sion_bike %>%
  as.data.frame() %>%
  select(-date)
```

In order to observe the availability of Bikes at each station from the past weeks, we plot on the following chart the probability that a certain amount of bikes will be available.

```{r, echo=FALSE, message=FALSE, heigth= }
x<-inspect_num(sion_bike_table)
show_plot(x, col_palette=3, plot_layout = c(4, 4)) +
  ggtitle("Bike Probability per Station") + xlim(0, 25)+ylim(0.00, 0.25)


sion_bike_long %>% autoplot(Number) + ylab("Number of Bikes") +
  facet_wrap(vars(Stations), ncol = 4) + 
  theme(legend.position = "none") + guides(x =  guide_axis(angle = 25)) +
  labs(x = "Time [10']",
       y = "Number") +
  ggtitle("Wednesdays Usage(Mdn) - Bikes - Sion Stations")
```

<br> From these graphs, we could observe the patterns as follow:

+ Bietschhorn, Campus and GSN stations seem to have a similar probability across the number of bicycles with the highest probability is at number 7, and GSD station with the highest at 3. We can also mention that the flow of users at these stations is more constant than at the rest.

+ The stations Agasse and Platta show the highest probability than the rest of the stations with an amount of 0 bikes across their number of bikes. Moreover, we note a similar pattern on Cible and Planta, but with a lower probability.

+ The rest of the stations have a different pattern than the rest, some with the highest peak at number 4 (Blancherie, Furet, PRP), some at number 2 (Bramois), and rare cases such as Stade that have several peaks (4,5,6). 

One important discovery that we found during the exploratory analysis was that most of the observations were measured every 10 minutes, but there were also some observations with values measured by 20, 30, 40, 70, 60, and 120 minutes that we had to remove as they represent less than 2% of our data.

```{r, echo=FALSE, message=FALSE}
# Table containing the time differences different from 10 min interval
library(gtsummary)
tbl_summary(
  sion_bike_diff,
  type = all_continuous() ~ "continuous2",
  statistic = list(all_continuous() ~ c("{median}, ({p25}, {p75})",
                                        "{mean}, ({min}, {max})"),
                   all_categorical() ~ "{n}, ({p}%)")) %>%
  modify_caption("**Time Interval in Timeseries**") %>%
  bold_labels()

#kbl(sion_bike_diff) %>%
# kable_styling(bootstrap_options = "striped", full_width = F, position = "float_right")
```

## Cleaning and Wrangling

Since our goal is to produce a forecast for Wednesday, May 25th, we decided to change the dates of our time series to weekdays. To do so, we created a new column called “weekday” so we can filter the data for Wednesdays only. 

In order to find the time intervals between the following date with the previous one, we created a new column called “time” with the same information as the column “date” (our index), so we could work on this column without modifying our index column. We then converted the column time as numeric and subtracted all dates with the day-before dates. The result of this computation was allocated into a new column called “minutes” which was divided by 60 to have the data in minutes. Furthermore, we eliminated the column “time” because it was created only for computation purposes.

Time differences represent a gap on our time series because most of the data, as we mentioned before, are represented by 10-minutes intervals. In order to have a more accurate forecast, we decided to fill those gaps represented as NA's by considering the previous value of the past observation.

These procedures were applied to all Sion stations. To have a better understanding of how our final time series look, we show below the head of the Bietschhorn time series as an example.


```{r, message=FALSE, warning=FALSE, include=FALSE}
################################### Bietschhorn ##############################################

# Creation of time series
Bietschhorn$weekday <- weekdays(Bietschhorn$date) # Get the weekday values
Bietschhorn$time <- as.POSIXct(Bietschhorn$date, format = "%H:%M:%S %p")
Bietschhorn$time <- as.numeric(Bietschhorn$date) #convert date values to numeric
as.numeric(Bietschhorn$time)

bietschhorn <- Bietschhorn %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
bietschhorn$minutes <- as.numeric(as.character(bietschhorn$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
bietschhorn <- bietschhorn %>% filter(minutes == 10) %>%
  select(-time) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
bietschhorn.gaps <- has_gaps(bietschhorn)
bietschhorn.gaps <- scan_gaps(bietschhorn)
bietschhorn <- bietschhorn %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
bietschhorn_ts <- bietschhorn %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes, name)
scan_gaps(bietschhorn_ts) # no missing values
bietschhorn_ts$Bikes <- bietschhorn_ts$Bike + bietschhorn_ts$`E-Bike`
bietschhorn_ts <- bietschhorn_ts %>% 
  select(-Bike, -`E-Bike`) %>%
  relocate(Bikes, .before = Capacity)

#  convert our data frame from wide to long format.
bietschhorn <- bietschhorn_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
bietschhorn_wednesday <- bietschhorn %>%
  filter(weekday == "Wednesday") 
lubridate::day(bietschhorn_wednesday$date) <- 18
lubridate::month(bietschhorn_wednesday$date) <- 05
bietschhorn_wednesday <- bietschhorn_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
bietschhorn_wednesday$Number <- ceiling(bietschhorn_wednesday$Number)

### Time series for Wednesdays - Bike ###
bietschhorn_wednesdays_bikes <- bietschhorn %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Blancherie ##############################################

# Creation of time series
Blancherie$weekday <- weekdays(Blancherie$date) # Get the weekday values
Blancherie$time <- as.POSIXct(Blancherie$date, format = "%H:%M:%S %p")
Blancherie$time <- as.numeric(Blancherie$date) #convert date values to numeric
as.numeric(Blancherie$time)

blancherie <- Blancherie %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
blancherie$minutes <- as.numeric(as.character(blancherie$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
blancherie <- blancherie %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
blancherie.gaps <- has_gaps(blancherie)
blancherie.gaps <- scan_gaps(blancherie)
blancherie <- blancherie %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
blancherie_ts <- blancherie %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(blancherie_ts) # no missing values
blancherie_ts$Bikes <- blancherie_ts$Bike + blancherie_ts$`E-Bike`
blancherie_ts <- blancherie_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
blancherie <- blancherie_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
blancherie_wednesday <- blancherie %>%
  filter(weekday == "Wednesday") 
lubridate::day(blancherie_wednesday$date) <- 18
lubridate::month(blancherie_wednesday$date) <- 05
blancherie_wednesday <- blancherie_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
blancherie_wednesday$Number <- ceiling(blancherie_wednesday$Number)

# Time series for Wednesdays - Bikes
blancherie_wednesdays_bikes <- blancherie %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)

################################### Agasse ##############################################

# Creation of time series
weekday <- weekdays(Agasse$date)
Agasse$weekday <- weekday # Get the weekday values
Agasse$time <- as.POSIXct(Agasse$date, format = "%H:%M:%S %p")
Agasse$time <- as.numeric(Agasse$date) #convert date values to numeric
as.numeric(Agasse$time)

agasse <- Agasse %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
agasse$minutes <- as.numeric(as.character(agasse$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
agasse <- agasse %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
agasse.gaps <- has_gaps(agasse)
agasse.gaps <- scan_gaps(agasse)
agasse <- agasse %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
agasse_ts <- agasse %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(agasse_ts) # no missing values
agasse_ts$Bikes <- agasse_ts$Bike + agasse_ts$`E-Bike`
agasse_ts <- agasse_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
agasse <- agasse_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
agasse_wednesday <- agasse %>%
  filter(weekday == "Wednesday") 
lubridate::day(agasse_wednesday$date) <- 18
lubridate::month(agasse_wednesday$date) <- 05
agasse_wednesday <- agasse_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
agasse_wednesday$Number <- ceiling(agasse_wednesday$Number)

# Time series for Wednesdays - Bikes
agasse_wednesdays_bikes <- agasse %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Bramois ##############################################

# Creation of time series
weekday <- weekdays(Bramois$date)
Bramois$weekday <- weekday # Get the weekday values
Bramois$time <- as.POSIXct(Bramois$date, format = "%H:%M:%S %p")
Bramois$time <- as.numeric(Bramois$date) #convert date values to numeric
as.numeric(Bramois$time)

bramois <- Bramois %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
bramois$minutes <- as.numeric(as.character(bramois$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
bramois <- bramois %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
bramois.gaps <- has_gaps(bramois)
bramois.gaps <- scan_gaps(bramois)
bramois <- bramois %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
bramois_ts <- bramois %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(bramois_ts) # no missing values
bramois_ts$Bikes <- bramois_ts$Bike + bramois_ts$`E-Bike`
bramois_ts <- bramois_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
bramois <- bramois_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
bramois_wednesday <- bramois %>%
  filter(weekday == "Wednesday") 
lubridate::day(bramois_wednesday$date) <- 18
lubridate::month(bramois_wednesday$date) <- 05
bramois_wednesday <- bramois_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
bramois_wednesday$Number <- ceiling(bramois_wednesday$Number)

# Time series for Wednesdays - Bikes
bramois_wednesdays_bikes <- bramois %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Campus ##############################################

# Creation of time series
weekday <- weekdays(Campus$date)
Campus$weekday <- weekday # Get the weekday values
Campus$time <- as.POSIXct(Campus$date, format = "%H:%M:%S %p")
Campus$time <- as.numeric(Campus$date) #convert date values to numeric
as.numeric(Campus$time)

campus <- Campus %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
campus$minutes <- as.numeric(as.character(campus$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
campus <- campus %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
campus.gaps <- has_gaps(campus)
campus.gaps <- scan_gaps(campus)
campus <- campus %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
campus_ts <- campus %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(campus_ts) # no missing values
campus_ts$Bikes <- campus_ts$Bike + campus_ts$`E-Bike`
campus_ts <- campus_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
campus <- campus_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
campus_wednesday <- campus %>%
  filter(weekday == "Wednesday") 
lubridate::day(campus_wednesday$date) <- 18
lubridate::month(campus_wednesday$date) <- 05
campus_wednesday <- campus_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
campus_wednesday$Number <- ceiling(campus_wednesday$Number)

# Time series for Wednesdays - Bikes
campus_wednesdays_bikes <- campus %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Cible ##############################################

# Creation of time series
weekday <- weekdays(Cible$date)
Cible$weekday <- weekday # Get the weekday values
Cible$time <- as.POSIXct(Cible$date, format = "%H:%M:%S %p")
Cible$time <- as.numeric(Cible$date) #convert date values to numeric
as.numeric(Cible$time)

cible <- Cible %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
cible$minutes <- as.numeric(as.character(cible$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
cible <- cible %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
cible.gaps <- has_gaps(cible)
cible.gaps <- scan_gaps(cible)
cible <- cible %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
cible_ts <- cible %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(cible_ts) # no missing values
cible_ts$Bikes <- cible_ts$Bike + cible_ts$`E-Bike`
cible_ts <- cible_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
cible <- cible_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
cible_wednesday <- cible %>%
  filter(weekday == "Wednesday") 
lubridate::day(cible_wednesday$date) <- 18
lubridate::month(cible_wednesday$date) <- 05
cible_wednesday <- cible_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
cible_wednesday$Number <- ceiling(cible_wednesday$Number)

# Time series for Wednesdays - Bikes
cible_wednesdays_bikes <- cible %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### CRR ##############################################

# Creation of time series
weekday <- weekdays(CRR$date)
CRR$weekday <- weekday # Get the weekday values
CRR$time <- as.POSIXct(CRR$date, format = "%H:%M:%S %p")
CRR$time <- as.numeric(CRR$date) #convert date values to numeric
as.numeric(CRR$time)

crr <- CRR %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
crr$minutes <- as.numeric(as.character(crr$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
crr <- crr %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
crr.gaps <- has_gaps(crr)
crr.gaps <- scan_gaps(crr)
crr <- crr %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
crr_ts <- crr %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(crr_ts) # no missing values
crr_ts$Bikes <- crr_ts$Bike + crr_ts$`E-Bike`
crr_ts <- crr_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
crr <- crr_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
crr_wednesday <- crr %>%
  filter(weekday == "Wednesday") 
lubridate::day(crr_wednesday$date) <- 18
lubridate::month(crr_wednesday$date) <- 05
crr_wednesday <- crr_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types,index = date) %>%
  mutate(weekday = "Wednesday")
crr_wednesday$Number <- ceiling(crr_wednesday$Number)

# Time series for Wednesdays - Bikes
crr_wednesdays_bikes <- crr %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)

################################### Furet ##############################################

# Creation of time series
weekday <- weekdays(Furet$date)
Furet$weekday <- weekday # Get the weekday values
Furet$time <- as.POSIXct(Furet$date, format = "%H:%M:%S %p")
Furet$time <- as.numeric(Furet$date) #convert date values to numeric
as.numeric(Furet$time)

furet <- Furet %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
furet$minutes <- as.numeric(as.character(furet$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
furet <- furet %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
furet.gaps <- has_gaps(furet)
furet.gaps <- scan_gaps(furet)
furet <- furet %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
furet_ts <- furet %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(furet_ts) # no missing values
furet_ts$Bikes <- furet_ts$Bike + furet_ts$`E-Bike`
furet_ts <- furet_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
furet <- furet_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
furet_wednesday <- furet %>%
  filter(weekday == "Wednesday") 
lubridate::day(furet_wednesday$date) <- 18
lubridate::month(furet_wednesday$date) <- 05
furet_wednesday <- furet_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
furet_wednesday$Number <- ceiling(furet_wednesday$Number)

# Time series for Wednesdays - Bikes
furet_wednesdays_bikes <- furet %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### GSN ##############################################

# Creation of time series
weekday <- weekdays(GSN$date)
GSN$weekday <- weekday # Get the weekday values
GSN$time <- as.POSIXct(GSN$date, format = "%H:%M:%S %p")
GSN$time <- as.numeric(GSN$date) #convert date values to numeric
as.numeric(GSN$time)

gsn <- GSN %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
gsn$minutes <- as.numeric(as.character(gsn$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
gsn <- gsn %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
gsn.gaps <- has_gaps(gsn)
gsn.gaps <- scan_gaps(gsn)
gsn <- gsn %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
gsn_ts <- gsn %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(gsn_ts) # no missing values
gsn_ts$Bikes <- gsn_ts$Bike + gsn_ts$`E-Bike`
gsn_ts <- gsn_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
gsn <- gsn_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
gsn_wednesday <- gsn %>%
  filter(weekday == "Wednesday") 
lubridate::day(gsn_wednesday$date) <- 18
lubridate::month(gsn_wednesday$date) <- 05
gsn_wednesday <- gsn_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
gsn_wednesday$Number <- ceiling(gsn_wednesday$Number)

# Time series for Wednesdays - Bikes
gsn_wednesdays_bikes <- gsn %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)

################################### Planta ##############################################

# Creation of time series
weekday <- weekdays(Planta$date)
Planta$weekday <- weekday # Get the weekday values
Planta$time <- as.POSIXct(Planta$date, format = "%H:%M:%S %p")
Planta$time <- as.numeric(Planta$date) #convert date values to numeric
as.numeric(Planta$time)

planta <- Planta %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
planta$minutes <- as.numeric(as.character(planta$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
planta <- planta %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
planta.gaps <- has_gaps(planta)
planta.gaps <- scan_gaps(planta)
planta <- planta %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
planta_ts <- planta %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(planta_ts) # no missing values
planta_ts$Bikes <- planta_ts$Bike + planta_ts$`E-Bike`
planta_ts <- planta_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
planta <- planta_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

planta_wednesday <- planta %>%
  filter(weekday == "Wednesday") 
lubridate::day(planta_wednesday$date) <- 18
lubridate::month(planta_wednesday$date) <- 05
planta_wednesday <- planta_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
planta_wednesday$Number <- ceiling(planta_wednesday$Number)

# Time series for Wednesdays - Bikes
planta_wednesdays_bikes <- planta %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Platta ##############################################

# Creation of time series
weekday <- weekdays(Platta$date)
Platta$weekday <- weekday # Get the weekday values
Platta$time <- as.POSIXct(Platta$date, format = "%H:%M:%S %p")
Platta$time <- as.numeric(Platta$date) #convert date values to numeric
as.numeric(Platta$time)

platta <- Platta %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
platta$minutes <- as.numeric(as.character(platta$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
platta <- platta %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
platta.gaps <- has_gaps(platta)
platta.gaps <- scan_gaps(platta)
platta <- platta %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
platta_ts <- platta %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(platta_ts) # no missing values
platta_ts$Bikes <- platta_ts$Bike + platta_ts$`E-Bike`
platta_ts <- platta_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
platta <- platta_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
platta_wednesday <- platta %>%
  filter(weekday == "Wednesday") 
lubridate::day(platta_wednesday$date) <- 18
lubridate::month(platta_wednesday$date) <- 05
platta_wednesday <- platta_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
platta_wednesday$Number <- ceiling(platta_wednesday$Number)

# Time series for Wednesdays - Bikes
platta_wednesdays_bikes <- platta %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)

################################### PRP ##############################################

# Creation of time series
PRP$weekday <- weekdays(PRP$date) # Get the weekday values
PRP$time <- as.POSIXct(PRP$date, format = "%H:%M:%S %p")
PRP$time <- as.numeric(PRP$date) #convert date values to numeric
as.numeric(PRP$time)

prp <- PRP %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
prp$minutes <- as.numeric(as.character(prp$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
prp <- prp %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
prp.gaps <- has_gaps(prp)
prp.gaps <- scan_gaps(prp)
prp <- prp %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
prp_ts <- prp %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(prp_ts) # no missing values
prp_ts$Bikes <- prp_ts$Bike + prp_ts$`E-Bike`
prp_ts <- prp_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
prp <- prp_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
prp_wednesday <- prp %>%
  filter(weekday == "Wednesday") 
lubridate::day(prp_wednesday$date) <- 18
lubridate::month(prp_wednesday$date) <- 05
prp_wednesday <- prp_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
prp_wednesday$Number <- ceiling(prp_wednesday$Number)

# Time series for Wednesdays - Bikes
prp_wednesdays_bikes <- prp %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Scex ##############################################

# Creation of time series
weekday <- weekdays(Scex$date)
Scex$weekday <- weekday # Get the weekday values
Scex$time <- as.POSIXct(Scex$date, format = "%H:%M:%S %p")
Scex$time <- as.numeric(Scex$date) #convert date values to numeric
as.numeric(Scex$time)

scex <- Scex %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
scex$minutes <- as.numeric(as.character(scex$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
scex <- scex %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
scex.gaps <- has_gaps(scex)
scex.gaps <- scan_gaps(scex)
scex <- scex %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
scex_ts <- scex %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(scex_ts) # no missing values
scex_ts$Bikes <- scex_ts$Bike + scex_ts$`E-Bike`
scex_ts <- scex_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
scex <- scex_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
scex_wednesday <- scex %>%
  filter(weekday == "Wednesday") 
lubridate::day(scex_wednesday$date) <- 18
lubridate::month(scex_wednesday$date) <- 05
scex_wednesday <- scex_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
scex_wednesday$Number <- ceiling(scex_wednesday$Number)

# Time series for Wednesdays - Bikes
scex_wednesdays_bikes <- scex %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Stade ##############################################

# Creation of time series
weekday <- weekdays(Stade$date)
Stade$weekday <- weekday # Get the weekday values
Stade$time <- as.POSIXct(Stade$date, format = "%H:%M:%S %p")
Stade$time <- as.numeric(Stade$date) #convert date values to numeric
as.numeric(Stade$time)

stade <- Stade %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
stade$minutes <- as.numeric(as.character(stade$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
stade <- stade %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
stade.gaps <- has_gaps(stade)
stade.gaps <- scan_gaps(stade)
stade <- stade %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
stade_ts <- stade %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(stade_ts) # no missing values
stade_ts$Bikes <- stade_ts$Bike + stade_ts$`E-Bike`
stade_ts <- stade_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
stade <- stade_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
stade_wednesday <- stade %>%
  filter(weekday == "Wednesday") 
lubridate::day(stade_wednesday$date) <- 18
lubridate::month(stade_wednesday$date) <- 05
stade_wednesday <- stade_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
stade_wednesday$Number <- ceiling(stade_wednesday$Number)

# Time series for Wednesdays - Bikes
stade_wednesdays_bikes <- stade %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### Stand ##############################################

# Creation of time series
weekday <- weekdays(Stand$date)
Stand$weekday <- weekday # Get the weekday values
Stand$time <- as.POSIXct(Stand$date, format = "%H:%M:%S %p")
Stand$time <- as.numeric(Stand$date) #convert date values to numeric
as.numeric(Stand$time)

stand <- Stand %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
stand$minutes <- as.numeric(as.character(stand$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
stand <- stand %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
stand.gaps <- has_gaps(stand)
stand.gaps <- scan_gaps(stand)
stand <- stand %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
stand_ts <- stand %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(stand_ts) # no missing values
stand_ts$Bikes <- stand_ts$Bike + stand_ts$`E-Bike`
stand_ts <- stand_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
stand <- stand_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
stand_wednesday <- stand %>%
  filter(weekday == "Wednesday") 
lubridate::day(stand_wednesday$date) <- 18
lubridate::month(stand_wednesday$date) <- 05
stand_wednesday <- stand_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
stand_wednesday$Number <- ceiling(stand_wednesday$Number)

# Time series for Wednesdays - Bikes
stand_wednesdays_bikes <- stand %>% 
  filter(Types == "Bikes" ) %>% 
  filter(weekday == "Wednesday") %>%
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)


################################### GSD ##############################################

# Creation of time series
weekday <- weekdays(GSD$date)
GSD$weekday <- weekday # Get the weekday values
GSD$time <- as.POSIXct(GSD$date, format = "%H:%M:%S %p")
GSD$time <- as.numeric(GSD$date) #convert date values to numeric
as.numeric(GSD$time)

gsd <- GSD %>% 
  mutate(minutes = time - lag(time, default = first(time))) # subtract days
gsd$minutes <- as.numeric(as.character(gsd$minutes))/60 # transform to minutes

# Filter the data by time difference of 10 min
gsd <- gsd %>% filter(minutes == 10) %>%
  select(-time,-name) %>%
  relocate(date, .before = Bike)

# Identifying the gaps on the ts and fill them
gsd.gaps <- has_gaps(gsd)
gsd.gaps <- scan_gaps(gsd)
gsd <- gsd %>% 
  fill_gaps(.full = TRUE) 

# Replace NA's values as previous row 
gsd_ts <- gsd %>%
  fill(Bike, `E-Bike`, Capacity, weekday, minutes)
scan_gaps(gsd_ts) # no missing values
gsd_ts$Bikes <- gsd_ts$Bike + gsd_ts$`E-Bike`
gsd_ts <- gsd_ts %>% 
  select(-Bike, -`E-Bike`)

#  convert our data frame from wide to long format.
gsd <- gsd_ts %>% 
  gather("Bikes", "Capacity", key = Types, value = Number) %>%
  relocate(Types, .before = weekday) %>%
  relocate(Number, .before = weekday)

### Usage for Wednesdays - Bikes ###
gsd_wednesday <- gsd %>%
  filter(weekday == "Wednesday") 
lubridate::day(gsd_wednesday$date) <- 18
lubridate::month(gsd_wednesday$date) <- 05
gsd_wednesday <- gsd_wednesday %>%
  group_by(date, Types) %>%
  summarise(Number = median(Number)) %>%
  as_tsibble(key = Types, index = date) %>%
  mutate(weekday = "Wednesday")
gsd_wednesday$Number <- ceiling(gsd_wednesday$Number)

# Time series for Wednesdays - Bikes
gsd_wednesdays_bikes <- gsd %>% 
  filter(Types == "Bikes" & weekday == "Wednesday") %>% 
  mutate(t = row_number()) %>% 
  update_tsibble(index = t, regular = TRUE)

```

```{r, echo=FALSE, message=FALSE}
kbl(head(bietschhorn_ts), caption = "Bietschhorn final table", bold= TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

Then

```{r, echo=FALSE, message=FALSE}
# Create a New master table for all the stations with the Median usage per station

############ Prepare data ################

bietschhorn_bikes <- bietschhorn_wednesday %>%
  spread(Types, Number) %>%
  rename(Bietschhorn = Bikes) %>%
  select(date, Bietschhorn)

blancherie_bikes <- blancherie_wednesday %>%
  spread(Types, Number) %>%
  rename(Blancherie = Bikes) %>%
  select(date, Blancherie)

cible_bikes <- cible_wednesday %>%
  spread(Types, Number) %>%
  rename(Cible = Bikes) %>%
  select(date, Cible)

gsd_bikes <- gsd_wednesday %>%
  spread(Types, Number) %>%
  rename(GSD = Bikes) %>%
  select(date, GSD)


prp_bikes <- prp_wednesday %>%
  spread(Types, Number) %>%
  rename(PRP = Bikes) %>%
  select(date, PRP)


platta_bikes <- platta_wednesday %>%
  spread(Types, Number) %>%
  rename(Platta = Bikes) %>%
  select(date, Platta)


planta_bikes <- planta_wednesday %>%
  spread(Types, Number) %>%
  rename(Planta = Bikes) %>%
  select(date, Planta)


crr_bikes <- crr_wednesday %>%
  spread(Types, Number) %>%
  rename(CRR = Bikes) %>%
  select(date, CRR)


campus_bikes <- campus_wednesday %>%
  spread(Types, Number) %>%
  rename(Campus = Bikes) %>%
  select(date, Campus)


scex_bikes <- scex_wednesday %>%
  spread(Types, Number) %>%
  rename(Scex = Bikes) %>%
  select(date, Scex)


furet_bikes <- furet_wednesday %>%
  spread(Types, Number) %>%
  rename(Furet = Bikes) %>%
  select(date, Furet)


agasse_bikes <- agasse_wednesday %>%
  spread(Types, Number) %>%
  rename(Agasse = Bikes) %>%
  select(date, Agasse)


stade_bikes <- stade_wednesday %>%
  spread(Types, Number) %>%
  rename(Stade = Bikes) %>%
  select(date, Stade)


gsn_bikes <- gsn_wednesday %>%
  spread(Types, Number) %>%
  rename(GSN = Bikes) %>%
  select(date, GSN)


stand_bikes <- stand_wednesday %>%
  spread(Types, Number) %>%
  rename(Stand = Bikes) %>%
  select(date, Stand)


bramois_bikes <- bramois_wednesday %>%
  spread(Types, Number) %>%
  rename(Bramois = Bikes) %>%
  select(date, Bramois)

################# Create Master tables #####################

library(purrr)
sion_bikes_mean <- list(bietschhorn_bikes, blancherie_bikes, cible_bikes, gsd_bikes, prp_bikes, 
                platta_bikes, planta_bikes, crr_bikes, campus_bikes, scex_bikes, furet_bikes,
                agasse_bikes, stade_bikes, gsn_bikes, stand_bikes, bramois_bikes) %>%
  reduce(dplyr::left_join, by= "date")

# Convert ts to tsibble and pivot to long format
sion_bikes_mean_long <- sion_bikes_mean %>%   
  gather("Bietschhorn", "Blancherie", "Cible", "GSD", "PRP", "Platta", "Planta",
         "CRR", "Campus", "Scex", "Furet", "Agasse", "Stade", "GSN", "Stand",
         "Bramois", key = Stations, value = Number)

```

```{r, echo=FALSE, message=FALSE}
########### Plot Them ################

sion_bikes_mean_long %>% autoplot(Number) + ylab("Number of Bikes") +
  facet_wrap(vars(Stations), ncol = 4) + 
  theme(legend.position = "none") + guides(x =  guide_axis(angle = 25)) +
  labs(x = "Time [10']",
       y = "Number") +
  ggtitle("Wednesdays Usage(Mdn) - Bikes - Sion Stations")

```

## 3. Modeling

This part is about building on your knowledge of time series techniques to model your data. You can investigate various models but you should justify in your report your choices regarding these. Pay attention to the conditions that are needed to apply a specific model.Treat also carefully seasonality, outliers, colinearity, covariates, special events, etc.

Remember the following steps: (a) Aggregation choice for hierarchical time series (b) Model building (c) Model selection
